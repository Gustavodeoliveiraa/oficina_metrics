{% extends "base.html" %}



{% block content %}

    <div class="card mt-4">
        <div class="card-body">

            <div class="row">
                <div class="col-md-6">
                    <div class="card bg-primary">
                        <div class="card-body">
                            <h5 class="card-title">Valor total de vendas</h5>
                            <p class="card-text text-white font-weigth-bold display-6">R$ {{total_sales}}</p>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mt-4 mt-md-0">
                    <div class="card bg-danger">
                        <div class="card-body">
                            <h5 class="card-title">Gastos</h5>
                            <p class="card-text text-white font-weigth-bold display-6">R$ {{total_cost}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="row mt-4 mb-4 justify-content-center">
        <div class="col-md-6 text-center  mt-2 mt-md-0">
            <h5 class="text-center mb-3">
                Valor de vendas (Últimos 10 Dias)
            </h5>
            <canvas id="dailySalesChart"></canvas>
        </div>
        <div class="col-md-6 text-center mt-5 mt-md-0">
          <h5 class="text-center mb-3">
              Quantidade de Vendas Diárias
          </h5>
          <canvas id="dailySalesPerDayChart"></canvas>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const dailySalesDataChart = document.getElementById('dailySalesChart')
            const dailySalesData = {{daily_sales_date|safe}}
            
            new Chart(dailySalesDataChart, {
                type: 'line',
                data: {
                  labels: dailySalesData.dates,
                  datasets: [{
                    label: 'Valor em vendas',
                    data: dailySalesData.values,
                    borderWidth: 1,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 2,
                    tension: 0.1
                  }]
                },
                options: {
                  scales: {
                    y: {
                      beginAtZero: true
                    }
                  },
                }
              }
            );

            const dailySalesPerDayDataChart = document.getElementById('dailySalesPerDayChart')
            const dailySalesPErDayData = {{daily_sales_quantity_date|safe}}
            new Chart(dailySalesPerDayDataChart, {
              type: 'bar',
              data: {
                labels: dailySalesPErDayData.dates,
                datasets: [{
                  label: 'Quantidade de Vendas',
                  data: dailySalesPErDayData.values,
                  borderWidth: 1,
                  backgroundColor: 'rgba(255, 99, 132, 0.6)',
                  borderColor: 'rgba(255, 99, 132, 1)',
                }]
              },
              options: {
                scales: {
                  y: {
                    min: 0,
                  }
                }
              }
            });

            const quantiyItemsnPerCategoryChart = document.getElementById('quantity-per-category')
            const quantiyItemsnPerCategory = {{quantity_itens_per_category|safe}}

            console.log(quantiyItemsnPerCategory)

            new Chart(quantiyItemsnPerCategoryChart, {
              type: 'doughnut', // Tipo do gráfico
              data: {
                  labels: Object.keys(quantiyItemsnPerCategory),
                  datasets: [{
                      label: 'Quantidade',
                      data: Object.values(quantiyItemsnPerCategory),
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)',
                          'rgba(255, 206, 86, 0.2)',
                          'rgba(75, 192, 192, 0.2)',
                          'rgba(153, 102, 255, 0.2)',
                          'rgba(255, 159, 64, 0.2)',
                          'rgba(201, 203, 207, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)',
                          'rgba(201, 203, 207, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
          });
 
        });


    </script>


    <div class="row mb-3">
        <div class="col-md-4 col-lg-6">
            <a href="{% url "create_service" %}" class="btn btn-success float-end">
                <i class="bi bi-plus">Novo Serviço</i>
            </a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="thead-dark">
                <tr>
                    <td>Carro</td>
                    <td>Placa</td>
                    <td>Serviço</td>
                    <td>Valor</td>
                    <td>Data</td>
                </tr>
            </thead>

            <tbody>
                {% for service in services %}
                    </tr>
                        <td>{{service.car}}</td>
                        <td>{{service.license_plate}}</td>
                        <td>{{service.service}}</td>
                        <td>{{service.service_price}}</td>
                        <td>{{service.created_at|date:'d/m/Y'}}</td>
                        <td class="text-center">
                            <a href="" class="btn btn-info btn-sm">
                                <i class="bi bi-eye"></i>
                            </a>
    
                            <a href="{% url "update_service" service.pk%}" class="btn btn-warning btn-sm">
                                <i class="bi bi-pencil"></i>
                            </a>
    
                            <a href="{% url "delete_service" service.pk%}" class="btn btn-danger btn-sm">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}